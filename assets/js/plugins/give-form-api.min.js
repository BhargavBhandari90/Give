!function(e){var t,i;e.fn.give_reveal_form=function(){return this.each(function(){var t=e(this),i=e(".give-btn-reveal",t);i.on("click",function(t){t.preventDefault(),e(this).trigger("give_reveal_form_button_click"),e(this).prev("form").slideDown(),e(this).show()})})},e.fn.give_modal_form=function(){return this.each(function(){var t=e(this),i=e(".give-btn-modal",t);i.magnificPopup({items:{src:e("form",t),type:"inline"},callbacks:{beforeOpen:function(){i.trigger("give_modal_form_button_click"),i.hide()},open:function(){i.trigger("give_modal_form_popup_open")},close:function(){i.trigger("give_modal_form_popup_close"),e(".give-show-without-modal",t).length&&e("form",t).removeClass("mfp-hide"),i.show()}}})})},e.fn.give_button_form=function(){return this.each(function(){var t=e(this),i=e(".give-btn-button",t);i.magnificPopup({items:{src:e("form",t),type:"inline"},callbacks:{beforeOpen:function(){i.trigger("give_button_form_button_click"),i.hide()},open:function(){i.trigger("give_button_form_popup_open")},close:function(){i.trigger("give_button_form_popup_close"),i.show()}}})})},e.fn.give_stepper_form=function(){return this.each(function(){var t=e(this),i=e(".give-block-wrapper",t),r=e('input[name="next"]',t),n=e('input[name="prev"]',t),a=100/(parseInt(i.length)-1),o=500;return i.length?(i.each(function(t,i){e(i).attr("data-step",t)}),e(".give-block-wrapper:first-child",t).addClass("give-active"),t.css({paddingBottom:e(".give-block-wrapper.give-active",t).height()+"px"}),void t.on("click",'input[name="prev"], input[name="next"]',function(){var i=e(".give-block-wrapper.give-active",t),r=e(this).attr("name"),n="next"===r,l=n?i.next(".give-block-wrapper"):i.prev(".give-block-wrapper"),c=parseInt(a)*parseInt(l.attr("data-step")),s=n?"-":"",d=n?"":"-";e("html, body").animate({scrollTop:t.offset().top},"fast"),t.css({paddingBottom:l.height()+"px"}),e(".current_steps",t).animate({width:c+"%"},o,function(){}),i.animate({left:s+"100%"},o).removeClass("give-active"),l.css({left:d+"100%"}).animate({left:"0%"},o).addClass("give-active")})):(r.remove(),n.remove(),!1)})},e.fn.give_colorpicker_fields=function(){return this.each(function(){var t=e(this);t.parents(".wp-picker-container").length||t.parents(".give-template").length||t.wpColorPicker()})},e.fn.give_media_fields=function(){return this.each(function(){e(this).on("click",function(r){return r.preventDefault(),i=e(this),t?void t.open():(t=wp.media.frames.file_frame=wp.media({title:give_form_api_var.metabox_fields.media.button_title,frame:"post",button:{text:give_form_api_var.metabox_fields.media.button_title},multiple:!1}),t.on("insert",function(){var r=t.state().get("selection").first().toJSON(),n=i.prev(),a=e(".attachment-display-settings .size").val(),o="id"===n.data("fvalue")?r.id:r.sizes[a].url;n.val(o)}),t.on("open",function(){e("a.media-menu-item").each(function(){switch(e(this).text().trim()){case"Create Gallery":case"Insert from URL":e(this).hide()}})}),e("body").on("click",".thumbnail",function(t){var i=e(".attachment-display-settings");i.length&&(e(".alignment",i).closest("label").hide(),e(".link-to",i).closest("label").hide(),e(".attachment-details label").hide())}),t.open(),!1)})})};var r={init:function(){this.setup_repeatable_fields(),this.handle_repeater_group_events()},setup_repeatable_fields:function(){jQuery(function(){jQuery(".give-repeatable-field-section").each(function(){var t=e(this),i={wrapper:".give-repeatable-fields-section-wrapper",container:".container",row:".give-row",add:".give-add-repeater-field-section-row",remove:".give-remove",move:".give-move",template:".give-template",confirm_before_remove_row:!0,confirm_before_remove_row_text:give_form_api_var.confirm_before_remove_row_text,is_sortable:!0,before_add:null,after_add:n,before_remove:null,after_remove:a,sortable_options:{placeholder:"give-ui-placeholder-state-highlight",start:function(t,i){e("body").trigger("repeater_field_sorting_start",[i.item])},stop:function(t,i){e("body").trigger("repeater_field_sorting_stop",[i.item])},update:function(i,r){r.item.next().hasClass("give-template")&&r.item.next().after(r.item);var n=e(".give-row",t).not(".give-template");if(n.length){var a=1;n.each(function(t,i){var r=e(".give-field, label",e(i));r.length&&r.each(function(){var t=e(this).parents(".give-field-wrap"),i=e(this);e.each(this.attributes,function(e,r){var n=this.value.replace(/\[/g,"_").replace(/]/g,""),o=n+"_field",l="",c="";this.value&&(this.value=this.value.replace(/\[\d+\]/g,"["+(a-1)+"]"),c=this.value.replace(/\[/g,"_").replace(/]/g,""),t.hasClass(o)&&(l=c+"_field",t.removeClass(o).addClass(l)),n==i.attr("id")&&i.attr("id",c))})}),a++}),t.trigger("repeater_field_row_reordered",[r.item])}}}};jQuery(this).repeatable_fields(i)})})},handle_repeater_group_events:function(){var t=e(".give-repeatable-field-section"),i=e("body");i.on("click",".give-row-head button",function(){var t=e(this).closest("tr");t.toggleClass("closed"),e(".give-row-body",t).toggle()}),t.on("repeater_field_new_row_added repeater_field_row_deleted repeater_field_row_reordered",function(){o(e(this))}),i.on("repeater_field_sorting_start",function(t,i){var r=e(".wp-editor-area",i);r.length&&r.each(function(t,i){window.setTimeout(function(){tinyMCE.execCommand("mceRemoveEditor",!0,e(i).attr("id"))},300)})}),i.on("repeater_field_sorting_stop",function(t,i){var r=e(".wp-editor-area",i);r.length&&r.each(function(t,i){window.setTimeout(function(){var t=e(i).attr("id");tinyMCE.execCommand("mceAddEditor",!0,t),window.setTimeout(function(){switchEditors.go(t,"html"),e("#"+t+"-tmce").trigger("click")},100)},300)})}),t.each(function(t,i){var r=e(i);o(r),parseInt(r.data("close-tabs"))&&(e(".give-row-head button",r).trigger("click"),e(".give-template",r).removeClass("closed"),e(".give-template .give-row-body",r).show())}),t.on("repeater_field_new_row_added",function(t,i,r){e(".give-colorpicker",e(this)).give_colorpicker_fields(),e(".give-media-upload",e(this)).give_media_fields();var n=e("div[data-wp-editor]",r);n.length&&n.each(function(t,i){var r=e(i),n=e(".wp-editor-wrap",r),a=e("textarea",r),o="give_wysiwyg_unique_"+Math.random().toString().replace(".","_"),l=n.prev();a.attr("id",o),e.post(ajaxurl,{action:"give_load_wp_editor",wp_editor:r.data("wp-editor"),wp_editor_id:o,textarea_name:e("textarea",r).attr("name")},function(t){n.remove(),l.after(t);var i=tinyMCEPreInit.mceInit[Object.keys(tinyMCEPreInit.mceInit)[0]],r=tinyMCEPreInit.qtInit[Object.keys(tinyMCEPreInit.qtInit)[0]];tinyMCEPreInit.qtInit[a.attr("id")]=e.extend(!0,r,{id:o}),tinyMCEPreInit.mceInit[o]=e.extend(!0,i,{body_class:o+" locale-"+i.wp_lang_attr.toLowerCase(),selector:"#"+o}),tinymce.init(tinyMCEPreInit.mceInit[o]),quicktags(tinyMCEPreInit.qtInit[o]),QTags._buttonsInit(),window.setTimeout(function(){switchEditors.go(o,"html"),e("#"+o+"-tmce").trigger("click")},100),window.wpActiveEditor||(window.wpActiveEditor=o)})})})}},n=function(t,i){var r=e(t).attr("data-rf-row-count"),n=e(t),a=n.parents(".give-repeatable-field-section");r++,e("*",i).each(function(){e.each(this.attributes,function(e,t){this.value=this.value.replace("{{row-count-placeholder}}",r-1)})}),e(t).attr("data-rf-row-count",r),a.trigger("repeater_field_new_row_added",[t,i])},a=function(t){var i=e(t),r=i.parents(".give-repeatable-field-section"),n=e(t).attr("data-rf-row-count");i.attr("data-rf-row-count",--n),r.trigger("repeater_field_row_deleted")},o=function(t){if(parseInt(t.data("group-numbering"))){var i=e(".give-row-head h2 span",t),r=i.data("header-title");i.each(function(t,i){var n=e(i);n.parents(".give-template").length||n.html(r+": "+t)})}};e(document).ready(function(){var t=e(".give-display-style-reveal"),i=e(".give-display-style-modal"),n=e(".give-display-style-button"),a=e(".give-display-style-stepper"),o=e(".give-media-upload"),l=e(".give-colorpicker");t.length&&t.give_reveal_form(),i.length&&i.give_modal_form(),n.length&&n.give_button_form(),a.length&&a.give_stepper_form(),l.length&&l.give_colorpicker_fields(),o.length&&o.give_media_fields(),e(".give-repeater-field-wrap").length&&(r.init(),e("button.give-add-repeater-field-section-row").on("click",function(e){e.preventDefault()}))})}(jQuery);